<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf AI Assistant</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .mobile-text { font-size: 0.9rem; }
            .mobile-padding { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function GolfNewsAgent() {
            const [activeTab, setActiveTab] = useState('setup');
            const [apiKey, setApiKey] = useState('');
            const [apiKeyStored, setApiKeyStored] = useState(false);
            const [news, setNews] = useState([]);
            const [loading, setLoading] = useState(false);
            const [summary, setSummary] = useState('');
            const [error, setError] = useState('');
            const [newsType, setNewsType] = useState('general');
            
            // Predictions state
            const [predictions, setPredictions] = useState(null);
            const [predictionsLoading, setPredictionsLoading] = useState(false);
            const [selectedTour, setSelectedTour] = useState('pga');

            useEffect(() => {
                const stored = localStorage.getItem('anthropic_api_key');
                if (stored) {
                    setApiKey(stored);
                    setApiKeyStored(true);
                    setActiveTab('news');
                }
            }, []);

            const saveApiKey = () => {
                if (apiKey.trim()) {
                    localStorage.setItem('anthropic_api_key', apiKey.trim());
                    setApiKeyStored(true);
                    setActiveTab('news');
                    setError('');
                } else {
                    setError('Please enter a valid API key');
                }
            };

            const clearApiKey = () => {
                if (confirm('Are you sure you want to clear your API key?')) {
                    localStorage.removeItem('anthropic_api_key');
                    setApiKey('');
                    setApiKeyStored(false);
                    setActiveTab('setup');
                }
            };

            const callClaudeAPI = async (messages, maxTokens = 1000) => {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-api-key": apiKey,
                        "anthropic-version": "2023-06-01"
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: maxTokens,
                        messages: messages,
                        tools: [
                            {
                                "type": "web_search_20250305",
                                "name": "web_search"
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error ${response.status}: ${errorText}`);
                }

                return await response.json();
            };

            const fetchGolfNews = async (type) => {
                setLoading(true);
                setError('');
                setSummary('');
                setNews([]);

                try {
                    let searchQuery = 'golf news today';
                    if (type === 'pga') searchQuery = 'PGA Tour news today';
                    else if (type === 'majors') searchQuery = 'golf majors news';
                    else if (type === 'european') searchQuery = 'DP World Tour golf news';
                    else if (type === 'players') searchQuery = 'professional golfers news';

                    const data = await callClaudeAPI([
                        {
                            role: "user",
                            content: `Search for the latest ${searchQuery}. Please provide:
1. A brief summary of the top 3-5 most important golf stories right now
2. Format the response as JSON with this structure:
{
  "summary": "brief overview paragraph",
  "stories": [
    {
      "title": "story title",
      "summary": "2-3 sentence summary",
      "source": "source name"
    }
  ]
}

Return ONLY the JSON, no markdown formatting or backticks.`
                        }
                    ], 1000);

                    const fullResponse = data.content
                        .map(item => (item.type === "text" ? item.text : ""))
                        .filter(Boolean)
                        .join("\n");

                    const cleanResponse = fullResponse.replace(/```json|```/g, "").trim();
                    const newsData = JSON.parse(cleanResponse);
                    
                    setSummary(newsData.summary);
                    setNews(newsData.stories || []);
                } catch (err) {
                    console.error("Error fetching golf news:", err);
                    setError(`Failed to fetch news: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const fetchPredictions = async (tour) => {
                setPredictionsLoading(true);
                setError('');

                try {
                    const tourName = tour === 'pga' ? 'PGA Tour' : 'DP World Tour';
                    
                    const data = await callClaudeAPI([
                        {
                            role: "user",
                            content: `Search for information about this week's upcoming ${tourName} tournament. Analyze:

1. Tournament name and course details
2. Course conditions (wind, firmness, rough, greens)
3. Course characteristics (length, par, type)
4. Weather forecast
5. Current betting odds for top players
6. Recent player form and stats

Predict the TOP 10 players most likely to win based on how their skills match the course.

Format as JSON:
{
  "tournament": "name",
  "course": "name",
  "location": "location",
  "dates": "dates",
  "courseAnalysis": {
    "type": "type",
    "length": "yardage",
    "par": "par",
    "conditions": "description",
    "keyFactors": ["factor1", "factor2", "factor3"]
  },
  "topPicks": [
    {
      "rank": 1,
      "player": "name",
      "odds": "odds",
      "reasoning": "2-3 sentences",
      "keyStrengths": ["strength1", "strength2"],
      "confidence": "high/medium"
    }
  ]
}

Return ONLY the JSON, no markdown.`
                        }
                    ], 2000);

                    const fullResponse = data.content
                        .map(item => (item.type === "text" ? item.text : ""))
                        .filter(Boolean)
                        .join("\n");

                    const cleanResponse = fullResponse.replace(/```json|```/g, "").trim();
                    const predictionsData = JSON.parse(cleanResponse);
                    
                    setPredictions(predictionsData);
                } catch (err) {
                    console.error("Error fetching predictions:", err);
                    setError(`Failed to fetch predictions: ${err.message}`);
                } finally {
                    setPredictionsLoading(false);
                }
            };

            const handleRefresh = () => {
                if (activeTab === 'news') {
                    fetchGolfNews(newsType);
                } else if (activeTab === 'predictions') {
                    fetchPredictions(selectedTour);
                }
            };

            const handleTypeChange = (type) => {
                setNewsType(type);
                fetchGolfNews(type);
            };

            const handleTourChange = (tour) => {
                setSelectedTour(tour);
                fetchPredictions(tour);
            };

            const getConfidenceColor = (confidence) => {
                if (confidence === 'high') return 'bg-green-100 text-green-800';
                return 'bg-yellow-100 text-yellow-800';
            };

            const getRankColor = (rank) => {
                if (rank === 1) return 'bg-yellow-400 text-yellow-900';
                if (rank === 2) return 'bg-gray-300 text-gray-800';
                if (rank === 3) return 'bg-orange-300 text-orange-900';
                return 'bg-blue-100 text-blue-800';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-3 sm:p-6">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                            <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 sm:w-12 sm:h-12 bg-green-600 rounded-full flex items-center justify-center text-white text-xl sm:text-2xl">
                                        â›³
                                    </div>
                                    <div>
                                        <h1 className="text-xl sm:text-3xl font-bold text-gray-800">Golf AI</h1>
                                        <p className="text-xs sm:text-base text-gray-600">News & Predictions</p>
                                    </div>
                                </div>
                                <div className="flex gap-2 w-full sm:w-auto">
                                    {apiKeyStored && (
                                        <>
                                            <button
                                                onClick={handleRefresh}
                                                disabled={loading || predictionsLoading}
                                                className="flex-1 sm:flex-none px-3 sm:px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 disabled:bg-gray-400 transition-colors"
                                            >
                                                {(loading || predictionsLoading) ? "..." : "ðŸ”„"}
                                            </button>
                                            <button
                                                onClick={clearApiKey}
                                                className="px-3 sm:px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors"
                                            >
                                                Clear Key
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>

                            {/* Tab Navigation */}
                            {apiKeyStored && (
                                <div className="flex gap-1 sm:gap-2 border-b border-gray-200 overflow-x-auto">
                                    <button
                                        onClick={() => setActiveTab('news')}
                                        className={`px-4 sm:px-6 py-2 sm:py-3 font-semibold transition-colors text-sm sm:text-base whitespace-nowrap ${
                                            activeTab === 'news'
                                                ? 'text-green-600 border-b-2 border-green-600'
                                                : 'text-gray-600 hover:text-gray-800'
                                        }`}
                                    >
                                        ðŸ“° News
                                    </button>
                                    <button
                                        onClick={() => {
                                            setActiveTab('predictions');
                                            if (!predictions) fetchPredictions('pga');
                                        }}
                                        className={`px-4 sm:px-6 py-2 sm:py-3 font-semibold transition-colors text-sm sm:text-base whitespace-nowrap ${
                                            activeTab === 'predictions'
                                                ? 'text-green-600 border-b-2 border-green-600'
                                                : 'text-gray-600 hover:text-gray-800'
                                        }`}
                                    >
                                        ðŸŽ¯ Predictions
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Error Message */}
                        {error && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-3 sm:px-4 py-2 sm:py-3 rounded-lg mb-4 sm:mb-6 text-sm">
                                {error}
                            </div>
                        )}

                        {/* SETUP TAB */}
                        {activeTab === 'setup' && (
                            <div className="bg-white rounded-lg shadow-lg p-4 sm:p-8">
                                <h2 className="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">ðŸ”‘ API Key Setup</h2>
                                
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                                    <h3 className="font-bold text-blue-900 mb-3 text-sm sm:text-base">Get your API key:</h3>
                                    <ol className="list-decimal list-inside space-y-2 text-blue-800 text-sm sm:text-base">
                                        <li>Visit <a href="https://console.anthropic.com/" target="_blank" className="underline font-semibold">console.anthropic.com</a></li>
                                        <li>Sign up or log in</li>
                                        <li>Go to "API Keys" in settings</li>
                                        <li>Click "Create Key"</li>
                                        <li>Copy and paste it below</li>
                                    </ol>
                                    <p className="mt-3 sm:mt-4 text-xs sm:text-sm text-blue-700">
                                        <strong>Note:</strong> Your key is stored locally on your device only.
                                    </p>
                                </div>

                                <div className="mb-4">
                                    <label className="block text-gray-700 font-semibold mb-2 text-sm sm:text-base">
                                        Anthropic API Key:
                                    </label>
                                    <input
                                        type="password"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        placeholder="sk-ant-..."
                                        className="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm sm:text-base"
                                    />
                                </div>

                                <button
                                    onClick={saveApiKey}
                                    className="w-full px-4 sm:px-6 py-2 sm:py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors text-sm sm:text-base"
                                >
                                    Save & Continue
                                </button>
                            </div>
                        )}

                        {/* NEWS TAB */}
                        {activeTab === 'news' && apiKeyStored && (
                            <>
                                <div className="bg-white rounded-lg shadow-lg p-3 sm:p-4 mb-4 sm:mb-6">
                                    <div className="flex gap-2 flex-wrap">
                                        {[
                                            { id: 'general', label: 'General' },
                                            { id: 'pga', label: 'PGA' },
                                            { id: 'majors', label: 'Majors' },
                                            { id: 'european', label: 'DP World' },
                                            { id: 'players', label: 'Players' }
                                        ].map(type => (
                                            <button
                                                key={type.id}
                                                onClick={() => handleTypeChange(type.id)}
                                                disabled={loading}
                                                className={`px-3 sm:px-4 py-2 rounded-lg transition-colors text-sm ${
                                                    newsType === type.id
                                                        ? 'bg-green-600 text-white'
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {type.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {!news.length && !loading && (
                                    <div className="bg-white rounded-lg shadow-lg p-6 sm:p-8 text-center">
                                        <p className="text-gray-600 text-sm sm:text-base">Select a category to get started</p>
                                    </div>
                                )}

                                {loading && (
                                    <div className="bg-white rounded-lg shadow-lg p-6 sm:p-8 text-center">
                                        <div className="inline-block animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-b-2 border-green-600"></div>
                                        <p className="mt-4 text-gray-600 text-sm sm:text-base">Loading news...</p>
                                    </div>
                                )}

                                {summary && !loading && (
                                    <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                                        <h2 className="text-lg sm:text-xl font-bold text-gray-800 mb-3">
                                            ðŸ“° Highlights
                                        </h2>
                                        <p className="text-gray-700 leading-relaxed text-sm sm:text-base">{summary}</p>
                                    </div>
                                )}

                                {news.length > 0 && !loading && (
                                    <div className="space-y-3 sm:space-y-4">
                                        <h2 className="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4">Top Stories</h2>
                                        {news.map((story, index) => (
                                            <div key={index} className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                                                <div className="flex items-start gap-3 sm:gap-4">
                                                    <div className="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm sm:text-base">
                                                        {index + 1}
                                                    </div>
                                                    <div className="flex-1">
                                                        <h3 className="text-base sm:text-xl font-bold text-gray-800 mb-2">
                                                            {story.title}
                                                        </h3>
                                                        <p className="text-gray-700 mb-3 leading-relaxed text-sm sm:text-base">
                                                            {story.summary}
                                                        </p>
                                                        <span className="px-2 sm:px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs sm:text-sm">
                                                            {story.source}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}

                        {/* PREDICTIONS TAB */}
                        {activeTab === 'predictions' && apiKeyStored && (
                            <>
                                <div className="bg-white rounded-lg shadow-lg p-3 sm:p-4 mb-4 sm:mb-6">
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => handleTourChange('pga')}
                                            disabled={predictionsLoading}
                                            className={`flex-1 px-4 sm:px-6 py-2 rounded-lg transition-colors font-semibold text-sm sm:text-base ${
                                                selectedTour === 'pga'
                                                    ? 'bg-green-600 text-white'
                                                    : 'bg-gray-200 text-gray-700'
                                            }`}
                                        >
                                            PGA Tour
                                        </button>
                                        <button
                                            onClick={() => handleTourChange('dp')}
                                            disabled={predictionsLoading}
                                            className={`flex-1 px-4 sm:px-6 py-2 rounded-lg transition-colors font-semibold text-sm sm:text-base ${
                                                selectedTour === 'dp'
                                                    ? 'bg-green-600 text-white'
                                                    : 'bg-gray-200 text-gray-700'
                                            }`}
                                        >
                                            DP World
                                        </button>
                                    </div>
                                </div>

                                {predictionsLoading && (
                                    <div className="bg-white rounded-lg shadow-lg p-6 sm:p-8 text-center">
                                        <div className="inline-block animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-b-2 border-green-600"></div>
                                        <p className="mt-4 text-gray-600 text-sm sm:text-base">Analyzing data...</p>
                                    </div>
                                )}

                                {predictions && !predictionsLoading && (
                                    <>
                                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                                            <h2 className="text-lg sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4">
                                                {predictions.tournament}
                                            </h2>
                                            <div className="grid grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4 text-sm sm:text-base">
                                                <div>
                                                    <p className="text-xs sm:text-sm text-gray-600">Course</p>
                                                    <p className="font-semibold text-gray-800">{predictions.course}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs sm:text-sm text-gray-600">Location</p>
                                                    <p className="font-semibold text-gray-800">{predictions.location}</p>
                                                </div>
                                            </div>
                                            
                                            {predictions.courseAnalysis && (
                                                <>
                                                    <div className="mb-3 sm:mb-4">
                                                        <p className="text-xs sm:text-sm text-gray-600 mb-2">Conditions</p>
                                                        <p className="text-gray-700 text-sm sm:text-base">{predictions.courseAnalysis.conditions}</p>
                                                    </div>
                                                    
                                                    <div>
                                                        <p className="text-xs sm:text-sm text-gray-600 mb-2">Key Factors</p>
                                                        <div className="flex gap-2 flex-wrap">
                                                            {predictions.courseAnalysis.keyFactors.map((factor, idx) => (
                                                                <span key={idx} className="px-2 sm:px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs sm:text-sm">
                                                                    {factor}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </div>

                                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                                            <h2 className="text-lg sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">
                                                ðŸŽ¯ Top 10 Picks
                                            </h2>
                                            
                                            <div className="space-y-3 sm:space-y-4">
                                                {predictions.topPicks.map((pick, index) => (
                                                    <div key={index} className="border-l-4 border-green-600 bg-gray-50 p-3 sm:p-5 rounded-r-lg">
                                                        <div className="flex items-start gap-3 sm:gap-4">
                                                            <div className={`flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 ${getRankColor(pick.rank)} rounded-full flex items-center justify-center font-bold text-base sm:text-lg`}>
                                                                {pick.rank}
                                                            </div>
                                                            <div className="flex-1">
                                                                <div className="flex items-start justify-between mb-2 flex-wrap gap-2">
                                                                    <h3 className="text-base sm:text-xl font-bold text-gray-800">
                                                                        {pick.player}
                                                                    </h3>
                                                                    <div className="flex gap-2 items-center flex-wrap">
                                                                        {pick.odds && (
                                                                            <span className="px-2 sm:px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs sm:text-sm font-semibold">
                                                                                {pick.odds}
                                                                            </span>
                                                                        )}
                                                                        {pick.confidence && (
                                                                            <span className={`px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-semibold ${getConfidenceColor(pick.confidence)}`}>
                                                                                {pick.confidence}
                                                                            </span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                                
                                                                <p className="text-gray-700 mb-2 sm:mb-3 leading-relaxed text-sm sm:text-base">
                                                                    {pick.reasoning}
                                                                </p>
                                                                
                                                                {pick.keyStrengths && (
                                                                    <div className="flex gap-2 flex-wrap">
                                                                        {pick.keyStrengths.map((strength, idx) => (
                                                                            <span key={idx} className="px-2 py-1 bg-green-50 text-green-700 rounded text-xs sm:text-sm border border-green-200">
                                                                                âœ“ {strength}
                                                                            </span>
                                                                        ))}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3 sm:p-4 mt-4 sm:mt-6">
                                            <p className="text-xs sm:text-sm text-yellow-800">
                                                <strong>Disclaimer:</strong> AI predictions for entertainment only. Research before betting.
                                            </p>
                                        </div>
                                    </>
                                )}
                            </>
                        )}

                        <div className="mt-6 sm:mt-8 text-center text-gray-600 text-xs sm:text-sm">
                            <p>Powered by Claude AI</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<GolfNewsAgent />, document.getElementById('root'));
    </script>
</body>
</html>
